<html>
  <head>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <nav class="navbar">
        <ul class="nav-ul">

            <li class="logo-li">
                <a href="#" class="nav-a">
                    <span class="link-text">songzhw</span>
                    <svg t="1584143304184" class="icon" viewBox="0 0 1035 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2014" width="36" height="36"><path d="M530.850448 573.163313c32.005172-31.883636 32.111192-87.434343-0.069818-119.489939C399.437114 322.845737 268.507336 191.603071 137.436629 60.506505c-12.621576-12.625455-27.585939-20.686869-45.26804-23.540364-3.529697-0.570182-7.085253-0.999434-10.630465-1.499798-1.025293 0-2.055758 0-3.081051 0-4.035232 0.575354-8.111838 0.943838-12.091475 1.757091-33.298101 6.818909-54.838303 26.616242-63.959919 59.278222-3.201293 11.479919-2.806949 24.85398-1.135192 35.701657 1.751919 11.344162 7.11499 21.818182 14.479515 30.904889 3.444364 4.252444 7.050343 8.418263 10.918788 12.291879 111.045818 111.127273 222.142061 222.222222 333.247354 333.293899 1.444202 1.444202 3.227152 2.554828 5.187232 4.080485-2.121697 2.222545-3.475394 3.696485-4.879515 5.100606C252.653437 625.450667 145.164468 733.112889 37.416912 840.506182c-15.829333 15.773737-33.541172 31.162182-36.146424 54.273293-1.233455 10.908444-1.859232 22.111677 0 32.929616 0.919273 5.363071 3.262061 10.423596 5.494949 15.358707 23.655434 52.318384 89.514667 64.241778 130.66602 23.186101C268.668953 835.315071 399.501761 703.987071 530.850448 573.163313L530.850448 573.163313zM78.451902 35.466343l-12.091475 1.757091C70.345235 36.410182 74.421841 36.041697 78.451902 35.466343L78.451902 35.466343zM551.467498 36.441212c-38.000485 2.858667-70.434909 37.034667-71.651556 75.106263-0.79903 24.979394 8.131232 45.650747 25.691798 63.197091 111.383273 111.252687 222.661818 222.615273 334.015354 333.893818 1.534707 1.534707 3.686141 2.448808 6.595232 4.327434-3.35903 2.667313-5.116121 3.803798-6.565495 5.253172-68.050747 68.000323-136.075636 136.035556-204.100525 204.065616C591.916791 765.814949 548.391619 809.360808 504.845761 852.880808c-19.449535 19.439192-28.328081 42.706747-24.045899 70.054788 4.829091 30.919111 22.440081 52.516202 51.712 63.010909 29.450343 10.550303 56.692364 4.803232 80.49002-15.848727 1.944566-1.682101 3.798626-3.470222 5.616485-5.288081 130.121697-130.111354 259.955071-260.509737 390.546101-390.141414 33.272242-33.035636 33.454545-88.934141 1.206303-121.050505C879.016912 322.804364 748.093599 191.557818 617.028064 60.456081c-12.626747-12.626747-27.611798-20.655838-45.288727-23.505455-3.534869-0.570182-7.090424-0.994263-10.635636-1.484283-1.030465 0-2.055758 0-3.086222 0.005172C555.835013 35.799919 553.659013 36.274424 551.467498 36.441212L551.467498 36.441212zM551.467498 36.441212" p-id="2015" fill="#707070"></path></svg>
                </a>
            </li>

            <li class="nav-li">
                <a href="#" class="nav-a">
                    <svg t="1583892639174" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2554" width="36" height="36">
                        <path class="svg-path" d="M512 749.226667l173.653333-48.213334 23.466667-260.266666H400.213333L392.533333 354.133333h324.266667l8.533333-84.906666H298.666667l23.893333 256.426666h293.973333l-9.813333 110.08-94.72 25.6-94.72-25.6-5.973333-70.826666h-85.333334l12.373334 136.106666L512 749.226667M173.653333 128h676.693334L789.333333 819.2 512 896l-277.333333-76.8L173.653333 128z" fill="#707070" p-id="2555"></path>
                    </svg>
                    <span class="link-text">html5</span>
                </a>
            </li>

            <li class="nav-li">
                <a href="#two" class="nav-a">
                    <svg t="1583892727455" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4169" width="36" height="36"><path class="svg-path" d="M512 512zM128.3 64.3l69.8 805.8 313.4 89.5L825.8 870l69.9-805.7H128.3z m580.9 669.3l-197.1 56.2-196.8-56.5L301.9 578h96.4l6.9 79.1 107.1 30.3 0.3 0.5h0.1l106.9-29.7L630.7 530H406.1l-8-99.9h241.1l8.8-101.9H280.2l-8-97.9H753l-43.8 503.3z" fill="#707070" p-id="4170"></path></svg>
                    <span class="link-text">css</span>
                </a>
            </li>

            <li class="nav-li">
                <a href="#three" class="nav-a">
                    <svg t="1583892794509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5036" width="36" height="36"><path class="svg-path" d="M238.592 155.648H399.36v450.56C399.36 809.984 302.08 880.64 146.432 880.64c-37.888 0-87.04-6.144-118.784-17.408l18.432-130.048c22.528 7.168 51.2 12.288 82.944 12.288 67.584 0 110.592-30.72 110.592-141.312V155.648h-1.024z m301.056 547.84c41.984 22.528 110.592 44.032 179.2 44.032 73.728 0 113.664-30.72 113.664-78.848 0-43.008-33.792-69.632-119.808-99.328-118.784-40.96-197.632-107.52-197.632-211.968C515.072 235.52 617.472 143.36 785.408 143.36c81.92 0 139.264 16.384 182.272 35.84L931.84 308.224c-27.648-13.312-79.872-33.792-148.48-33.792-69.632 0-103.424 32.768-103.424 68.608 0 45.056 38.912 65.536 132.096 101.376 125.952 46.08 184.32 112.64 184.32 214.016 0 119.808-91.136 221.184-286.72 221.184-81.92 0-161.792-22.528-201.728-44.032l31.744-132.096z" fill="#707070" p-id="5037"></path></svg>
                    <span class="link-text">js</span>
                </a>
            </li>

            <li class="nav-li">
                <a href="#four" class="nav-a">
                    <svg t="1583892805244" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5222" width="36" height="36"><path class="svg-path" d="M558.08 472.064c48.128 53.248-13.312 103.424-13.312 103.424s119.808-61.44 65.536-139.264c-51.2-71.68-91.136-107.52 122.88-232.448 0 1.024-335.872 86.016-175.104 268.288" fill="#707070" p-id="5223"></path><path class="svg-path" d="M610.304 5.12s101.376 101.376-96.256 258.048C356.352 389.12 478.208 460.8 514.048 543.744 420.864 459.776 354.304 386.048 399.36 317.44 463.872 216.064 651.264 166.912 610.304 5.12" fill="#707070" p-id="5224"></path><path class="svg-path" d="M720.896 757.76c183.296-95.232 98.304-188.416 39.936-175.104-15.36 3.072-21.504 5.12-21.504 5.12s5.12-8.192 16.384-11.264c117.76-40.96 207.872 120.832-37.888 186.368-1.024 0 2.048-3.072 3.072-5.12m-337.92 38.912s-37.888 21.504 26.624 29.696c76.8 8.192 117.76 8.192 202.752-8.192 0 0 23.552 15.36 53.248 26.624-191.488 80.896-433.152-5.12-282.624-48.128m-23.552-106.496s-43.008 31.744 23.552 37.888c82.944 8.192 149.504 10.24 261.12-13.312 0 0 16.384 16.384 40.96 24.576-231.424 68.608-490.496 5.12-325.632-49.152" fill="#707070" p-id="5225"></path><path class="svg-path" d="M811.008 876.544s27.648 23.552-31.744 40.96c-111.616 34.816-460.8 45.056-558.08 2.048-34.816-15.36 31.744-35.84 51.2-40.96 21.504-5.12 34.816-3.072 34.816-3.072-38.912-28.672-251.904 52.224-107.52 75.776 390.144 62.464 712.704-28.672 611.328-74.752M400.384 578.56s-178.176 43.008-63.488 56.32c49.152 6.144 146.432 5.12 235.52-3.072 73.728-6.144 147.456-19.456 147.456-19.456s-26.624 11.264-45.056 24.576c-181.248 48.128-530.432 26.624-430.08-23.552 88.064-39.936 155.648-34.816 155.648-34.816" fill="#707070" p-id="5226"></path><path class="svg-path" d="M418.816 1015.808c176.128 11.264 446.464-6.144 453.632-90.112 0 0-13.312 31.744-146.432 56.32-150.528 27.648-336.896 24.576-446.464 6.144 2.048 1.024 24.576 20.48 139.264 27.648" fill="#707070" p-id="5227"></path></svg>
                    <span class="link-text">java</span>
                </a>
            </li>

            <li class="nav-li">
                <a href="#five" class="nav-a">
                    <svg t="1583892843741" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6396" width="36" height="36"><path class="svg-path" d="M848.896 567.296c-32.768 0-62.464 7.168-86.016 19.456-9.216-17.408-17.408-32.768-19.456-45.056-1.024-13.312-4.096-20.48-1.024-36.864 1.024-16.384 12.288-38.912 12.288-39.936 0-1.024-1.024-10.24-20.48-10.24s-35.84 3.072-36.864 9.216c-1.024 4.096-6.144 16.384-7.168 28.672-3.072 17.408-38.912 78.848-58.368 111.616-6.144-13.312-12.288-23.552-13.312-32.768-1.024-13.312-4.096-20.48-1.024-36.864 1.024-16.384 12.288-38.912 12.288-39.936 0-1.024-1.024-10.24-20.48-10.24s-35.84 3.072-36.864 9.216-4.096 16.384-7.168 28.672c-4.096 12.288-50.176 114.688-62.464 141.312-6.144 13.312-12.288 25.6-15.36 32.768v1.024c-3.072 6.144-6.144 10.24-6.144 10.24-3.072 4.096-6.144 9.216-7.168 9.216s-3.072-12.288 0-29.696c7.168-35.84 23.552-92.16 23.552-93.184s3.072-10.24-10.24-16.384c-13.312-4.096-17.408 3.072-19.456 3.072s-1.024 3.072-1.024 3.072 15.36-62.464-28.672-62.464c-26.624 0-65.536 29.696-84.992 56.32-12.288 6.144-36.864 20.48-63.488 33.792-10.24 6.144-20.48 12.288-30.72 16.384 0 0-1.024-1.024-1.024-3.072-53.248-56.32-151.552-96.256-147.456-174.08 1.024-28.672 10.24-101.376 188.416-188.416 145.408-72.704 263.168-52.224 282.624-7.168 28.672 63.488-62.464 181.248-214.016 197.632-58.368 6.144-88.064-16.384-95.232-23.552-7.168-9.216-9.216-9.216-12.288-7.168-4.096 3.072-1.024 10.24 0 15.36 4.096 12.288 23.552 32.768 55.296 43.008 28.672 9.216 95.232 13.312 177.152-17.408 92.16-35.84 163.84-134.144 142.336-217.088s-163.84-115.712-294.912-68.608c-78.848 28.672-163.84 71.68-224.256 129.024-72.704 68.608-82.944 125.952-78.848 151.552C53.248 545.792 175.104 602.112 222.208 645.12c-3.072 1.024-4.096 3.072-6.144 3.072-23.552 12.288-115.712 59.392-139.264 111.616-26.624 58.368 4.096 100.352 23.552 104.448 62.464 17.408 125.952-13.312 160.768-65.536 33.792-50.176 29.696-117.76 15.36-147.456v-1.024c6.144-3.072 13.312-7.168 19.456-10.24 12.288-7.168 23.552-13.312 33.792-19.456-6.144 16.384-10.24 35.84-12.288 63.488-3.072 32.768 10.24 75.776 28.672 92.16 7.168 7.168 16.384 7.168 22.528 7.168 20.48 0 29.696-16.384 39.936-36.864 12.288-25.6 23.552-53.248 23.552-53.248s-13.312 76.8 23.552 76.8c13.312 0 28.672-17.408 33.792-26.624 6.144-9.216 0 0 1.024-1.024 1.024-3.072 3.072-3.072 3.072-3.072 6.144-10.24 17.408-30.72 36.864-68.608 23.552-47.104 47.104-107.52 47.104-107.52s1.024 15.36 9.216 38.912c4.096 13.312 13.312 29.696 19.456 45.056-6.144 7.168-9.216 12.288-9.216 12.288-3.072 6.144-7.168 11.264-13.312 19.456-19.456 22.528-41.984 49.152-45.056 56.32-3.072 9.216-3.072 15.36 4.096 20.48 4.096 4.096 13.312 4.096 23.552 4.096 16.384-1.024 29.696-6.144 33.792-7.168 9.216-3.072 19.456-9.216 29.696-16.384 19.456-13.312 29.696-32.768 28.672-59.392 0-15.36-6.144-28.672-10.24-41.984 1.024-3.072 3.072-4.096 4.096-7.168 29.696-43.008 52.224-91.136 52.224-91.136s1.024 15.36 9.216 38.912c3.072 12.288 10.24 25.6 16.384 38.912-28.672 22.528-45.056 49.152-50.176 65.536-10.24 30.72-3.072 46.08 13.312 49.152 7.168 1.024 17.408-1.024 25.6-6.144 10.24-3.072 20.48-9.216 32.768-16.384 19.456-13.312 36.864-32.768 35.84-59.392 0-12.288-3.072-23.552-7.168-33.792 23.552-10.24 53.248-15.36 92.16-10.24 82.944 10.24 99.328 61.44 96.256 82.944-3.072 22.528-20.48 33.792-26.624 36.864s-7.168 4.096-7.168 7.168c0 4.096 3.072 3.072 9.216 3.072 7.168-1.024 43.008-17.408 45.056-58.368-7.168-52.224-56.32-107.52-140.288-107.52z m-640 215.04c-26.624 29.696-65.536 41.984-81.92 30.72-17.408-10.24-10.24-55.296 22.528-86.016 20.48-19.456 47.104-36.864 63.488-47.104 4.096-3.072 10.24-6.144 16.384-10.24 1.024 0 1.024-1.024 1.024-1.024 1.024-1.024 3.072-1.024 4.096-3.072 16.384 46.08 4.096 83.968-25.6 116.736zM409.6 646.144c-9.216 23.552-29.696 82.944-41.984 79.872-10.24-3.072-16.384-47.104-1.024-92.16 7.168-22.528 23.552-49.152 32.768-59.392 15.36-16.384 30.72-22.528 35.84-15.36 3.072 8.192-19.456 71.68-25.6 87.04z m164.864 78.848c-4.096 1.024-7.168 3.072-9.216 3.072s1.024-3.072 1.024-3.072 20.48-22.528 28.672-32.768c4.096-6.144 10.24-13.312 16.384-20.48v3.072c1.024 24.576-25.6 41.984-36.864 50.176zM701.44 696.32c-3.072-1.024-3.072-9.216 7.168-30.72 4.096-9.216 13.312-22.528 28.672-36.864 1.024 6.144 3.072 10.24 3.072 16.384 0 33.792-24.576 45.056-38.912 51.2z" fill="#707070" p-id="6397"></path></svg>
                    <span class="link-text">scss</span>
                </a>
            </li>
        </ul>
    </nav>

    <main>
      <h1>Android Database: ROOM </h1>
      <p>Room has been out for serveral years, I haven't used it until this year. And I do learn a lot this time, and would like to take a note of it.  Before I dive in, I would say, the version of Room I'm using is :</p>
      <pre>
        def room_version = "2.2.2"

        // ROOM
        implementation "androidx.room:room-runtime:$room_version"
        kapt "androidx.room:room-compiler:$room_version"
        implementation "androidx.room:room-ktx:$room_version" // ktx + Coroutine
      </pre>
      <p>By the way, you can check here to see the release log of Room.</p>

      <h2 id="two">Relation</h2>
      <p>multiple tables and there might be 1:1, 1:Many, Many:Many relation among these tables.      I would like to explain how to build a many to many relation using Room, as this is the hardest relation for us. Say I have a recipe database, which has two tables: "ingredient" and "recipe". The relation between ingredient and recipe, of course, are many to many. Here is how we retrieve data from Database</p>
      <pre>
        @Entity
        data class Ingredient(
            val name: String,
            val isVegi: Int,
            @PrimaryKey(autoGenerate = true) var ingredientId: Int = 0
        )

        @Entity
        data class Cuisine(
            val name: String,
            @PrimaryKey(autoGenerate = true) var cuisineId: Int = 0
        )
      </pre>

      <h2 id="three">pre-packaged database</h2>
      <p>We didnt' have a pre-packaged database before ROOM 2.2. What we did is to insert a bunch of tables on the fresh install, but also need to be careful that we don't create tables every time we open the app.Lucky for us, ROOM 2.2 support pre-packaged database now. We can now put the database files to assert or file system. And since we need to place our pre-defined database to our apk, we normally would like to put it to assert foldwer.</p>
      <pre>
        database = Room.databaseBuilder(
            context.applicationContext,
            RecipeDatabase::class.java,
            "recipes.db"
        )
        .createFromAsset("database/recipe.app")
        .build()
      </pre>

      <h2 id="four">search text</h2>
      <p>We would type Select name from cuisine where name like '%egg%' to search data by a substring in a SQLite console. That's right. But things get a litte different in the ROOM. ROOM does not support the %% yet. So you have to do a text search by this</p>
      <pre>
        // DAO
        @Query("select * from Cuisine where name like :keyword")
            suspend fun getCuisinesBy(keyword: String): List&lt;Cuisine&gt;

        // ViewModel
        val arg = "%$keyword%"
        val cuisines = dao.getCuisinesBy(arg)
      </pre>


      <h2 id="five">unit test</h2>
      <p>One most important rule of unit test is "you can only fail one test because your logic is not working as you expected". That means, the connectivity of network/database, the multi-thread random issues should not be the reason to fail your test. The solution for that is isolation. Same for unit test against database code. We have to have a mock database to test, so tests don't fail just because the database connectivity.The wait to finish is another issue we have to deal with in the unit test. In the production, it's okay to wait the code to get the data from back-end or database. It's understandable. But when it comes to unit test, we need the unit test to run as fast as possible. (another import rule of unit test: fast!!!)</p>
      <pre>
            @Test
            fun insertManyToManyRelation_queryingGetsResults() = runBlocking {
                dao.insertCuisine(Cuisine("pizza", 1))
                dao.insertIngredient(Ingredient("dough", 3, 1, ""))
                dao.insertIngredient(Ingredient("chicken", 2, 0, ""))
                dao.insertJoint(IngredientCuisine(1, 1))
                dao.insertJoint(IngredientCuisine(2, 1))

                val result = dao.cuisinesWithIngredients()
                assertEquals(1, result.size)
                assertEquals(2, result[0].ingredients.size)
            }
      </pre>
    </main>
  </body>
</html>

